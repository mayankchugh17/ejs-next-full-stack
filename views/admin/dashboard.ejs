<% layout("layout/boilerplate") %>

<div class="min-h-screen bg-gray-900 text-gray-100">
  <%- include("../includes/navbar.ejs") %>

  <div class="flex pt-16 gap-10">
    <aside class="w-70 h-[calc(100vh-4rem)] fixed left-0 top-16 p-6 overflow-y-auto">
      <%- include("../particals/sidebar.ejs") %>
    </aside>

    <main class="ml-75 w-full p-8">
      
      <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-6 mb-8">
        <% const stats = [
          { label: "Today Booking", value: todayBookings, prefix: "" },
          { label: "Total Booking", value: totalBookings, prefix: "" },
          { label: "Total Customer", value: totalCustomers, prefix: "" },
          { label: "Total Revenue", value: totalRevenue, prefix: "$" }
        ] %>
        
        <% stats.forEach(stat => { %>
          <div class="bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700">
            <p class="text-gray-400 font-medium"><%= stat.label %></p>
            <h1 class="text-3xl font-bold mt-2"><%= stat.prefix %><%= stat.value %></h1>
          </div>
        <% }) %>
      </div>

      <div class="bg-gray-800 p-6 rounded-xl shadow-lg mb-8 border border-gray-700">
        <h2 class="text-lg font-semibold mb-4 text-blue-400">Reservations Overview</h2>
        <div class="h-64">
           <canvas id="reservationChart"></canvas>
        </div>
      </div>

      <div class="bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700">
        <h2 class="text-lg font-semibold mb-6">Today's Bookings</h2>
        <div class="overflow-x-auto">
          <table class="min-w-full text-left text-sm">
            <thead class="bg-gray-700 text-gray-300 uppercase text-xs">
              <tr>
                <th class="px-4 py-3">Name</th>
                <th class="px-4 py-3">Room Type</th>
                <th class="px-4 py-3">Dates</th>
                <th class="px-4 py-3">Financials (Paid/Due)</th>
                <th class="px-4 py-3 text-center">Status</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-700">
              <% bookingsList.forEach(b => { %>
                <tr class="hover:bg-gray-700/50 transition">
                  <td class="px-4 py-4 font-medium"><%= b.name %></td>
                  <td class="px-4 py-4"><%= b.roomType %></td>
                  <td class="px-4 py-4 text-xs text-gray-400">
                    <%= b.checkIn.toDateString() %> - <%= b.checkOut.toDateString() %>
                  </td>
                  <td class="px-4 py-4">
                    <span class="text-green-400">$<%= b.paidAmount %></span> / 
                    <span class="text-red-400">$<%= b.dueAmount %></span>
                  </td>
                  <td class="px-4 py-4 text-center">
                    <span class="px-3 py-1 rounded-full text-xs <%= b.status === 'Success' ? 'bg-green-900 text-green-200' : 'bg-yellow-900 text-yellow-200' %>">
                      <%= b.status %>
                    </span>
                  </td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
      </div>

      <footer class="mt-10 pb-6 text-center text-gray-500 text-xs">
        <%- include("../includes/footer.ejs") %>
      </footer>
    </main>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const data = <%- JSON.stringify(reservations) %>;
  const labels = data.map(item => "Day " + item._id);
  const values = data.map(item => item.total);

  new Chart(document.getElementById("reservationChart"), {
    type: "bar",
    data: {
      labels: labels,
      datasets: [{
        label: "Reservations",
        data: values,
        backgroundColor: "#3b82f6",
        borderRadius: 4
      }]
    },
    options: {
      maintainAspectRatio: false,
      plugins: { legend: { display: false } },
      scales: {
        x: { ticks: { color: "#9ca3af" }, grid: { display: false } },
        y: { ticks: { color: "#9ca3af" }, grid: { color: "#374151" } }
      }
    }
  });
</script>